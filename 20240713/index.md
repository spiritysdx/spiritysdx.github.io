# 机房本地服务器自建Gitea并使用


## 前言

由于Github在国内访问速度较慢，所以选择在本地服务器上自建Gitea，使用国内服务器内穿端口后访问速度较快，并且可以自己管理代码，更安全。

## 安装Gitea

安装时使用这里的方法：

[https://gitlab.com/packaging/gitea](https://gitlab.com/packaging/gitea)

但不要设置无人值守自动升级版本，容易升级到一个有BUG的新版本

更改默认配置需要更改文件```/etc/gitea/app.ini```

比如设置文件上传无限制

```
[repository.upload]
ENABLED = true
ALLOWED_TYPES =
FILE_MAX_SIZE = 1024
MAX_FILES = 100
```

写在```[security]```上面，每个模块```[]```的内容之间间隔一个空行

更改后执行

```
systemctl restart gitea
```

即可应用更改

## 配置内穿

见前几篇文章的教程

## 配置Gitea

打开内穿后的地址，如：```http://x.x.x.x:3000/```，首次访问会进入设置界面

设置界面需要修改三部分东西：

1. 不要使用默认的Mysql，而是选择sqlite3，更轻量化和易于自动维护，占用资源更少

2. 不要使用页面自动识别到的内穿后的地址，所有带IP地址的务必将全部的```公网IP```修改为```0.0.0.0```，否则你本地会打不开Gitea，修改为0.0.0.0后通过端口内穿来解决需要公网访问的问题

3. 设置管理员账号密码，用于登录Gitea，务必自行记忆用户名、邮箱、密码，不要忘记了

设置完成后，点击```Save```保存，然后点击```Next```进入下一步，完成安装。

进入管理员账户后，管理员设置这可设置新用户，这时候设置的新用户务必记住用户名和密码，后续需要使用。

## 使用Gitea

可直接修改下面这个文件并使用

[https://github.com/spiritLHLS/auto-push/blob/main/push_gitea.sh](https://github.com/spiritLHLS/auto-push/blob/main/push_gitea.sh)

每次使用这个脚本同步上传都会要求你输入用户名和密码进行验证，创建temp文件夹初始化仓库一次，仓库文件同步后上传内容一次，需要验证两次。(不要使用本仓库的push.sh文件，那是给GitHub用的)

其他东西只不过平台从Github换成了Gitea罢了，其他东西都是一样的，远程Git地址换成你映射出来的Gitea网站上显示的地址就行了。

(注意这里需要替换```0.0.0.0```变为你映射出来的```公网IP地址```，因为是内穿端口，有的版本网页显示的git地址没识别到穿出来的公网IP)

## 结语

至此，Gitea的安装、配置、使用全部完成，可以开始愉快地使用Gitea了。

以上经验仅限于小团队或个人使用，如果团队较大且有持续集成的需求，自建Gitlab是更好的选择，但也更重型，需要占用更多的资源。
